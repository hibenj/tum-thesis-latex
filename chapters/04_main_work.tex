\chapter{Methodology}\label{chapter:Methodology}
This chapter proposes a placement and routing algorithm, which overcomes the restrictions of ortho reviewed as state of the art in chapter \ref{chapter:SotA}. Therefore, three different signal distribution networks are introduced, which are implemented onto ortho both alone and in conjunction. Namely, an ordering, a majority gate, and a sequential distribution network. Since ortho has been shown to be restricted, but yet has a very powerful placement and routing procedure, the base of the algorithm should be maintained while implementing new functionalities as irregularities. The task of the signal distribution networks is to redistribute signals on the layout in a way that the irregular parts fit with the regular placement and routing and the basic algorithm can still work in a similar fashion as ortho. However, also the underlying logic network and the placement and routing itself have to be modified in order to add all the desired functionalities, resulting in the new algorithm.
Because ortho is restricted to the use of only 2DD-Wave clocking, signal distribution networks need the power to change the clocking in the layout to implement the functionalities they provide. Therefore, signal distribution networks must be implemented with care and synchronization constraints must be considered very closely.
The ordering distribution network is discussed below first, which aims to reduce the area in the input region of the layout. Afterwards the networks used for implementing majority gates and sequential parts are discussed and analyzed.

\section{Ordering Distribution Network}
Looking again at the resulting layout of a 2:1 mux or ortho in \ref{fig:ortho_mux_21}, it can be seen that in the first few rows, where the primary inputs are placed, no other gates are placed, because the space has to be reserved for rewiring in order to solve conflicts. The idea of the ordering distribution network is to allow gates to also be placed in this area to save space and to place inputs in a way that wire crossings may be minimized. To do so the ordering network has to resolve the conflicts in some other way. Recalling the pseudo-code from the ortho algorithm, an input has a conflict when it is colored south because it is not allowed to wire over the other inputs laying in the same column. This means the area overhead in the input region is highly dependent on the coloring assigned to the outgoing edges of the inputs. The algorithm used in the pseudocode line $3$ is implemented in a way that finds just \textit{some} valid but not an \textit{optimal} coloring for the given logic network. Unfortunately due to the algorithms nature it often assigns the color south to exactly these edges resulting in the said area overhead. Therefore, the first step is to improve the coloring of the logic network and prevent excess wiring. Secondly, a new rule for edges colored south inside the conflicting area can be introduced, making the rewiring redundant. The third idea which can be implemented in the network is an ordering of the inputs in order to allow those who are connected with the same gates to be placed near each other reducing wire expenses and crossings.

\begin{algorithm}[H]
	\vdots
	
	\begin{algorithmic}
		\State Convert $N$ to a 3-graph by substitution and balance inverters at fan-out nodes
		\State Order primary input nodes
		\State \vdots
		\State Generate \textbf{conditional} direction assignment $d : \Delta \rightarrow \{east, south\}$ and subdivide signals if necessary
		\State Compute topological ordering $v_1, . . . , v_i \in N$
		\State Extend $L$ by one column and reserve it for primary inputs
		\ForAll {vertex $v_1, ..., v_i \in N $ with at most two incoming signals $\sigma_1, \sigma_2$}
		\If{vertex $v$ is terminal/primary input}
		\State Extend $L$ by one row
		\State Place v at position $(0, h - 1)$
		\ElsIf{$d(\sigma_1) = d(\sigma_2) = east$}
		\State \vdots
		\ElsIf { signals are labeled $south$}
		\If{\textbf{not} root node exists}
		\State Extend $L$ by one row
		\EndIf
		\State $w_p \leftarrow$ max. horizontal position of v's predecessors
		\State Place v at position $(w _p, h - 1)$
		\EndIf
		
		\EndFor
		\State \vdots \\
		\Return $L$
	\end{algorithmic}
	\caption{Ortho changes with ordering distribution network}\label{alg:input_network}
\end{algorithm}

To discuss the idea, first the parts of the logic network, which belong to the ordering distribution network have to be determined. This can be deduced by looking at the layout, which shows the wasted area for mainly the primary inputs and nodes connected with them. Thus, all primary inputs and the gates which they are wired to, skipping over inverters, are viewed as part of the ordering distribution network. Skipping means that if the outgoing edge of an primary input is an inverter, the gate hanging on the outgoing edge of the inverter is considered. Starting with the different gates inputs can be connected to, the coloring they can have should be discussed. The direction assignment of one-input nodes, including inverters and fan-out nodes, can be chosen arbitrarily because the primary input to which they are connected has always only one outgoing edge, resulting in no dependencies. In this case, always the non-conflicting $east$ assignment can be chosen. When looking at two-input logic gates like AND and OR gates it has to be seen that the coloring can only be chosen arbitrarily if both input nodes are primary inputs, allowing again the non-conflicting assignment of $east$. In every other case, the direction assignment has to consider the coloring of the other incoming edge of the gate. In order find out the dependencies, the ordering distribution network places first every primary input connected to a fan-out node with its respective fan-out node itself into the layout. This has several advantages. First of all, the fan-out nodes give the constraints for the conditional coloring, which is introduced in the ordering distribution network. Also fan-out nodes produce new paths and therefore excess wiring, which means that their dependencies should be resolved as fast as possible by placing and routing them to their outgoing gates as fast as possible. Following the coloring rules, two outgoing edges of a node need to be colored in different directions, so that the fan-out gates placed into the network have one output assigned with color $east$ and one output assigned with color $south$. Considering that the second coloring constraint requires the other incoming edge of the gate connected to the colored edge $south$, also to be colored $south$, and the second incoming edge being connected to a primary input, we can see that a conditional coloring alone is not powerful enough to resolve all conflicts. For this case a new placement rule for the $south$ coloring is introduced in order to preserve the direction assignment rules but still resolve the conflict between primary inputs. The original algorithm part (lines 14-22) handling the placement of nodes based on their coloring makes sure that every gate placed $east$ occupies a new column and every node colored $south$ occupies a new row. These placement rules allow every gate to be placed without interfering with other gates, but the rules have been found too be to restrictive, allowing the following placement rule for $south$. If a node is labeled south and its predecessor, which has the lower horizontal position \textbf{also} has the higher vertical position, it is called \textit{root node} and the layout is \textbf{not} extended by a column while the gate is still in position $(w_p, h-1)$. Following this rule the gate is now placed in the same column as its predecessor with the higher y-coordinate. If we apply this to a two-input gate in the ordering distribution network with a primary input and a fan-out node as predecessors, the primary input is always the root node due to the ordering and new coloring. Thus, the new rule allows the two-input gate connected to the primary input colored $south$ and the fan-out node to be placed in the same column as the primary input, resulting in no conflict because the node is not \textit{actually} placed south of its predecessors. It was found that this rule could not only be utilized for this special case, but also for the general $south$ placement in the algorithm with one exception. Considering a fan-out node to be the root node, the coloring would wire both the eastern and the southern colored outgoing edges onto the same row, yielding a conflict. The resulting pseudo-code snippets replacing the used code are shown in algorithm \ref{alg:input_network}. Also it has to be considered that the conditional coloring in the distribution network still needs to include helping nodes e.g. when three fan-out nodes are connected to each other. Also before the coloring, first the input nodes need to be ordered according to the ideas presented. Thus, primary input nodes connected to fan-out nodes are placed first and then the primary input nodes, which are connected to the outgoing edges of the fan-out nodes are placed. This is done to reduce the distance between coherent gates and therefore also the number of wire crossings. Afterwards primary inputs directly connected to a gate which has its other incoming edge connected to a second primary input are placed. Finally all input nodes, which are not connected to the rest of the ordering distribution network are placed arbitrarily and the logic network is topologically ordered according to the new order of the primary inputs.
\begin{figure}
	\centering
	\includegraphics[scale=0.5]{input_network_mux_21}
	\caption{Placement and routing of a 2:1 mux network using the ortho algorithm with the ordering distribution network}\label{fig:input_network_mux_21}
\end{figure}
Some other issues are related to inverter nodes. As already mentioned they are skipped in the view of the ordering distribution network, but still need to be considered for the placement and routing. Assuming an inverter node which is assigned $south$ e.g. after a fan-out node and it should be placed in the same row as an primary input, a conflict arises because the input always has to wire east first. Thus, all inverters colored $south$ need to be placed to minimum the row of the most southern primary input plus one. In order to prevent to much overhead produced by inverters a balancing network is introduced, which aims to reduce the number of inverters in the logic network. Based on the substitution of the logic network into $N$ with inverter and fan-out nodes in some cases a fan-out node has two inverters connected to its outgoing edges. Then these inverters are substituted by one single inverter as incoming node to the fan-out, resulting in an overall lower number of inverter nodes.
Figure \ref{fig:input_network_mux_21} shows the placement and routing of the ortho algorithm after implementing the proposed ordering distribution network. The ordering of the inputs puts first the fan-out node and then the two connected primary inputs. In this case the ordering distribution network also considered the inverter at the outgoing edge to be colored east in order to produce less overhead, because if the inverter would be colored $south$ it would have to be placed underneath the primary inputs. Looking at the AND gate connecting the fan-out with the second primary input, we can see that the new rule for nodes placed south is used. This also applies for the AND gate connecting the third primary output to the inverter. The last OR gate is placed after the normal rules of the ortho algorithm. In the comparison to the layout in figure \ref{fig:ortho_mux_21} can be quickly seen that the resulting layout saves up place and even wire crossings. The exact results are presented and analyzed in the next chapter.

\section{Majority Gate Distribution Network}
In this section the placement and routing of majority gates, using the ortho algorithm is discussed and a distribution network is proposed. The placement and routing of majority gates plays a major role in QCA since the majority function can be implemented using only one gate in contrast to a CMOS implementation using multiple gates. But this theoretical advantage can only be exploited, if an efficient placement and routing exists. To this use a distribution network for ortho is introduced, allowing a comparison of design metrics after placing and routing a logic network using the majority gate distribution network with a logic network placed and routed using the QCA implementation without majority gates.

\subsection{The proposed signal distribution Network}
The 2DDWave clocked ortho algorithm only supports the placement and routing of 2-input logic gates and therefore the direction assignment contains only two directions $east$ and $south$. Since the goal of the distribution network is to introduce "+"-majority gates into the layout a RES-like clocking needs to be utilized, introducing tiles with three incoming tiles and one outgoing tile. In the RES scheme in figure \ref{subfig:RES} such a tile is on position $(1, 1)$ and would be suited to place a "+" majority gate on it and allowing it to be connected with three incoming signals. However, simply changing the clocking scheme of ortho to RES would be really inefficient and could not be easily implemented. On the one hand, if the clocking would be completely changed to RES, the algorithm could not utilize every row and column of the clocking since the RES scheme also supports signals to flow into western or northern direction. In RES only the first and third row such as the second and fourth column support eastern and southern signal propagation, so only these part of the clocking would be utilized for the placement of two input gates, which should lead to about a doubling in area usage considering only two-input logic gates. On the other hand, for the placement of three input majority gates a new direction assignment would have to be introduced to the logic network, since one signal would need a direction assignment $west$, changing the theory and complexity underlying the ortho algorithm. Another idea utilizing the RES scheme would be to only support it in some evenly distributed regions, supporting majority gates just at some permanently assigned places. For this the layout could be devised into $4x4$ sub-regions and e.g. every fifth sub-region would be RES clocked and the rest would be occupied with the 2DDWave scheme. On the one hand this realization should not produce that much area overhead since only some regions are inaccessible for two input logic gates, but the permanent clocking assignment only allows the placement of majority gates gets forced on some permanent spots, leading again to large area overhead if a majority gate should be placed far away from such a sub-region. Another consideration would be if a network with only majority gates should be placed in this implementation all the 2DDWave clocked area would be wasted. Another aspect the ortho algorithm makes use of is the trivial global synchronization constraints within a uniformly 2DDWave clocked layout. By introducing irregular clocking e.g. RES sub-regions, signals can pass a different amount of tiles in order to reach the same tile, therefore violating the global synchronization constraint. Figure !! a RES sub-region embedded in a 2DDWave clocked layout. Drawing the paths from three synchronous starting points to the three input tile, it can be seen, that the paths have different lengths, violating the design rules.


\begin{figure}
	\centering
	\includegraphics[scale=0.5]{Majority_Distribution_network}
	\caption{Proposed majority gate distribution network}\label{fig:QCA_Maj_nw}
\end{figure}


To avoid these complications, the proposed distribution network utilizes a custom clocking only in areas where majority gates are placed and find a solution for the global signal synchronization constraint. Therefore the placement and routing of solely two input gates should not produce any excess area. Figure \ref{fig:QCA_Maj_nw} shows the proposed majority gate signal distribution network, which is implemented into the ortho algorithm. The red marked cells indicate the three inputs for the majority gate distribution network. The cells in the middle of the tile are marked, because they can be connected from above north or the west, which would result once in a normal wire and once in a bent wire. The output in blue enables the algorithm to wire it in east or in south direction, hence allowing the algorithm to work without limitations. It is also important to mention that the input tiles as well as the output tiles have the same clocking number as in a regular 2DDWave scheme, allowing straight forward connections. Although no area overhead is produced for the already existing placement and routing of two-input gates, it can already be seen that the distribution network itself produces excess area due to its complex wiring, resulting again from the synchronization conditions that had to be considered designing it. The implementation of an AIG representation of the majority function implemented with ortho is depicted next to the distribution network to visualize that the placement and routing of this single majority gate barely safes area, although it has to be highlighted that no wire crossings are used. Under the assumption of really high costs for wire crossings the found majority gate distribution network is considered to be more ideal, even though a meaningful cost comparison of these two implementations can only be done under a cost function representing wire crossings in cost of normal gates.
In the following the design constraints used to design the signal distribution network are discussed. Firstly the distribution network should not contain any wire-crossings, since they are considered to be very costly. Introducing a cost-metric for wire-crossings may result in a more efficient implementation, but for this work wire-crossings should be excluded as design rule for the network. Secondly, the distribution network needs to meet the global synchronization constraint. Considering a 2DDWave clocked layout, every diagonal is synchronous and every signal wired on the same diagonal passes the same amount of tiles following the ortho placement and routing. If we look at the incoming tiles of a three input tile, it can be seen that only two of the incoming tiles are on the same diagonal and the third one is shifted by half a clock cycle. Hence the third incoming signal is delayed by half a clock cycle violating the global synchronization constraint. Also the signals need to pass a multiple of whole clock cycles in the signal distribution network in order to support the further use of 2DDWave and the local synchronization constraint. Therefore, first the initially synchronous signals are also delayed by half a clocking signal, satisfying the global synchronization constraint at the tile, where the majority gate is placed. Afterwards the output signal of the majority gate is again delayed by half a clock cycle so it can be connected to the regular 2DDWave clocking scheme used in the remaining layout. Adding up the delays resulting from the distribution networks leads to a total delay of one whole clock cycle of the signal propagating through the majority gate distribution network compared to all other signals in the logic network. Because the delay affects the gloal synchronization constraint, it has to be considered for each gate connected to the parents of a majority gate distribution network. In the following first the basic placement and routing of the majority gate distribution network and then the solution for meeting the global synchronization constraint in further placement and routing is discussed. 

\subsection{Placement and routing}
The placement and routing of the proposed signal distribution network is again bound to some constraints. First of all the coloring of majority gates has to be reviewed, since the logic network now includes three input nodes. However, the coloring algorithm can include helping nodes to resolve coloring conflicts of edges and therefore dividing every edge with a helping node shows, that a trivial coloring can be found also including three input nodes into the logic network. Another aspect regarding coloring is the need for a new direction in order to connect a third signal to the majority gate, but since the only occasion such a wiring happens is inside the fixed distribution network, which again can be placed and routed in the usual south-eastern manner, no additional directions need to be included. Further, the irregular clocking inside the signal distribution network has to be reviewed. These irregularities don't allow the algorithm to wire connections over the network, demanding a special treatment for the placement of the majority gates. From the algorithms perspective therefore a majority gate cannot be placed just south or east of another gate because these gates could need a wiring through the majority gate distribution network. Instead the algorithm is forced to assign the majority gate distribution network always south \textbf{and} east direction to prevent routing conflicts. This can be done by dividing the incoming edges with auxiliary nodes, also allowing a valid coloring. This also allows the coloring to be included into the input ordering distribution network, so that all inputs connected to a majority gate need to be colored $east$. The major drawback of this is, that again the area is not used optimally and the layout is extended in two directions compromising the beneficial use of the "+"-majority gate.

\subsection{Signal synchronization and buffer insertion}
The placement and routing using the proposed distribution network results in a delay of one clock cycles of signals passing through a majority gates. Since the tile-based clocking doesn't support a speedup of a signal, every other signal which comes into contact with a delayed signal also has to be delayed. Therefore a function is introduced to compute the delay of signals and allowing signals which are connected together to be synchronized by buffer insertion. For the delay computation, the algorithms views every incoming edge from every node starting at the primary output. If an incoming edge is connected to a majority gate, every other incoming edge of the same node gets a delay of one assigned, if this edge again is not connected to a majority gate. In the latter case all incoming edges of a node would be delayed, resulting again in a synchronous behavior. Hence the delay on one node can be maximum one clock cycle. After computing the delayed edges, they are realized by inserting wire buffers. Figure \ref{fig:QCA_buf} depicts a buffer in the east direction, which can also be used in the south direction by just rotating it 90 degrees. The snake-shaped structure delays a signal by exactly one clock cycle and is also used in custom placement and routing resulting from the QCA ONE library \cite{QCA_scl}. As in the majority gate distribution network, the buffers support irregular clocking, creating zones through which the algorithm cannot wire. In the case of buffers only one column or row is made impassable, allowing one to track them and introducing a rewiring for conflicts. Algorithm \ref{alg:majority_network} shows the code snippets which are changed and added to ortho in order to allow the placement and routing of majority gates distribution networks and the corresponding majority buffers. Figure \ref{fig:majority_with_buf} shows the placement of a majority gate inside the input distribution network and two and gates that have to be delayed to be connected to the delayed signal coming out of the majority gate distribution network. The insertion of the first buffer blocks the eastern direction of the second input. For this case, a resolve column is introduced where the signal can be assigned to a new row and be wired without conflict. From this layout, it can already be seen that the implementation of the majority gate distribution network brings several complications with it, all resulting in area overhead, which stands in contrast to the area which should be saved by introducing majority gates in the first place.

\begin{algorithm}[H]
	\vdots
	
	\begin{algorithmic}
		\State Convert $N$ to a 3-graph by substitution and balance inverters at fan-out nodes, except for majority gates
		\State Compute the delay as majority buffer insertion $buf_{maj}$ for every node and assign it to the incoming signals $\sigma$
		\State Order primary input nodes
		\State Create vectors with from the majority buffers blocked columns $bl_c$ and rows $bl_r$
		\State \vdots
		\ForAll {vertex $v_1, ..., v_i \in N $ with at most three incoming signals $\sigma_1, \sigma_2, \sigma_3$}
		\State Rewire incoming signals which are wired on $bl_c$ or $bl_r$
		\State \vdots
		\If{vertex $v$ has fanin of three (is a majority gate)}
		\If{$d(\sigma_1) = d(\sigma_2) = d(\sigma_3) = south$}
		\State{Extend $L$ by one row and wire the incoming signal to $(w_p, h-1)$ for every incoming signal}
		\EndIf
		\State Insert majority buffers according to the delay computed in $buf_{maj}$ and safe blocked columns $bl_c$ and rows $bl_r$
		\State Extend the layout by number of rows $(7)$ and columns $(5)$ of the majority gate distribution network and place the distribution network at $(w-5, h-7)$
		\State Connect incoming signals west to the inputs of the distribution network
		\ElsIf{$d(\sigma_1) = d(\sigma_2) = east$}
		\State Insert majority buffers according to the delay computed in $buf_{maj}$ and safe blocked rows $bl_r$
		\State \vdots
		\ElsIf { signals are labeled $south$}
		\State Insert majority buffers according to the delay computed in $buf_{maj}$ and safe blocked columns $bl_c$
		\State \vdots
		\EndIf
		
		\EndFor
%		\State \vdots \\
%		\Return $L$
	\end{algorithmic}
	\caption{Ortho changes with majority gate distribution network}\label{alg:majority_network}
\end{algorithm}

\begin{figure}
	\centering
	\begin{tikzpicture}
	\begin{scope}[xshift=-2.3cm, rotate=90]
		\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
		
		\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0.9/-0.45, 0.9/-0.9}
		{
			\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
			\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
			\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
		}
	\node[text=black] (A1) at (0.25,-0.7) {$1$};
	\end{scope}
	\begin{scope}[xshift=-2.3cm, yshift=-2.3cm, rotate=90]
		\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
		
		\node[text=black] (A1) at (0.25,-0.7) {$2$};
	\end{scope}
	\begin{scope}[shift={(0, 0)}, rotate=90]
			\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
			
			\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
			{
				\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
				\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
				\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
				\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
				\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
			}
			\node[text=black] (A1) at (0.25,-0.7) {$2$};
	\end{scope}
	\begin{scope}[xshift=3.2cm, yshift=1.3cm, rotate=180]
		\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
		
		\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
		{
			\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
			\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
			\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
		}
		\node[text=black] (four) at (0.25 ,1.05) {$1$};
	\end{scope}
	\begin{scope}[xshift=-0.4cm, yshift=-0.1cm, rotate=270]
		\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
		
		\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
		{
			\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
			\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
			\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
		}
		\node[text=black] (A1) at (1.1+0.85,1.1) {$3$};
	\end{scope}
	\begin{scope}[xshift=1cm, yshift=-1.4cm, rotate=0]
		\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
		
		\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
		{
			\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
			\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
			\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
			\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
		}
		\node[text=black] (four) at (1.95 ,-0.65) {$4$};
	\end{scope}

\begin{scope}[xshift=4.6cm, yshift=0cm, rotate=90]
	\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
	
	\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
	{
		\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
		\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
		\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
	}
	\node[text=black] (A1) at (0.25,-0.7) {$2$};
\end{scope}
\begin{scope}[xshift=7.8cm, yshift=1.3cm, rotate=180]
	\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
	
	\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
	{
		\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
		\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
		\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
	}
	\node[text=black] (four) at (0.25 ,1.05) {$1$};
\end{scope}
\begin{scope}[xshift=4.2cm, yshift=-0.1cm, rotate=270]
	\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
	
	\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
	{
		\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
		\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
		\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
	}
	\node[text=black] (A1) at (1.1+0.85,1.1) {$3$};
\end{scope}
\begin{scope}[xshift=5.6cm, yshift=-1.4cm, rotate=0]
	\draw[rounded corners] (-0.05, -0.1 - 0.85) rectangle (2.3-0.05, 2.3-0.1 - 0.85){};
	
	\foreach \x/\y in {0.9/0.9, 0.9/0.45, 0.9/0, 0/0, 0.45/0}
	{
		\draw[rounded corners = 0.3mm, fill=lightgray] (\x, 0 + \y) rectangle (1.2/3 + \x, 1.2/3 + \y){};
		\draw (0.3/3+ \x,0.3/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.3/3+ \y) circle (0.65mm);
		\draw (0.3/3+ \x,0.9/3 + \y) circle (0.65mm);
		\draw (0.9/3+ \x,0.9/3 + \y) circle (0.65mm);
	}
	\node[text=black] (four) at (1.95 ,-0.65) {$4$};
\end{scope}
		
	\end{tikzpicture}
	\caption{Buffer in $east$ direction with resolve column and respective clocking}\label{fig:QCA_buf}
\end{figure}

\begin{sidewaysfigure}
	\centering
	\includegraphics[scale=0.33]{TEST_maj_two_buf_cell_lvl_lyt_2}
	\caption{Placement and routing of a majority distribution network in conjunction with two primary inputs}\label{fig:majority_with_buf}
\end{sidewaysfigure}


\section{Sequential Distribution Network}

In this section, a distribution network is provided, which enables ortho to automatically design sequential circuits. To the authors' knowledge, there has been no solution to place and route sequential circuits in QCA yet. The only algorithms dealing with sequentiality in QCA, presented in Chapter \ref{chapter:SotA}, only translates CMOS structures directly into QCA and therefore require an external clock signal, which was stated to be unnatural, because QCA has its own clocking paradigm. For the placement and routing used here, the ideas of gates, able to delay signals from \cite{Walter}, was used and further developed for the automated placement and routing.\\
In order to implement sequential behavior into the circuit, not only a distribution network has to be designed but also the logic network has to be expanded with storage elements. They are represented in the logic network by registers with its corresponding input, determining the value, which has to be stored, and its output, which gives the register value to the combinational logic again after delaying it to the next \textit{circuit clocking cycle}. A circuit clocking cycle refers to one cycle of Bennet clocking that has propagated through the circuit completely. The registers are implemented into the logic network as follows. Register inputs (RIs) are treated similar to primary outputs, therefore they are dangling edges, which point to no node but additionally have a register output assigned. Register outputs (ROs) are treated similarly to primary inputs, being terminal vertices, but always feeding in the data which were given to the corresponding register input in the last circuit clocking cycle. Therefore, the logic network extends to $N = (\Lambda, I, RO, \Sigma, O, RI)$. Here it has to be mentioned that for the input distribution network due to their similarity ROs can be treated just like PIs, enabling the combination with the sequential distribution network.
Also, for placement and routing, the similarities between PIs/ROs and POs/RIs can be exploited. When the first part of ortho is performed, first the combinational logic part is placed and routed, treating ROs just like PIs and RIs just like POs. From this stage, a routing from the RIs to the ROs has to be found, which retains the local and global synchronization constraint. Because every register input has exactly one register output assigned, first of all, the register inputs are rewired and sorted in the same order as the register outputs. The ordering follows in a way that all RIs are put on a diagonal, and since to this point every gate is clocked uniformly with 2DDWave, the signals are all synchronized. With this starting position now wires with the same length have to be found between every register input and output. Since the wires now also have to go in western and northern directions in order to close the loop between the ROs in the upper left corner and the RIs in the down-right corner of the layout, the wiring is not arbitrary. One big issue is also that the clocking cannot be chosen independently for each back-loop because the loops cross each other. The solution found can be seen in an example depicted in figure !!. From this example another issue regarding timing can be derived. Considering a primary Input in a completely combinational circuit being placed in the fifth row of the layout. In this case the PI is set in a different \textit{time zone}, because its signal is globally delayed by one clock cycle. Until now the assumption was made, that an input network can be used to delay the primary input by one clocking cycle to achieve again global synchronization. When an RO is placed in a different time zone, this also has to be respected by the wiring of the registers. As already mentioned, the registers do not delay the information by only one clocking cycle but by multiple clocking slowing down the performance of the circuit drastically. This huge delay is due to the fact that ortho lays the combinational logic only in the south-eastern direction, always increasing the distance between PIs/ROs and POs/RIs. Therefore the sequential signal distribution network always grows with the size of the combinational logic.\\
Maybe a folding operation can be found for the ortho algorithm so that the distance between RIs and ROs can be decreased and therefore the delay produced by the sequential distribution network can be decreased as well.

%Because the implementation of a register proposed in chapter \ref{chapter:Preliminaries} delays a signal with additional wires and the register input and output are delayed in time, they are also divided in space, meaning they are at different positions and are represented by distinct gates.

%The scheme was already discussed and is depicted in figure \ref{fig:sequential_gate_sample}.

Importance of sequential circuits.\\
Point out how the registers are implemented.\\
Show how the distribution network is generated, where Ris and Ros are placed and how they are treated within the network.\\
Make clear that this implementation is slowing down the circuit significantly.